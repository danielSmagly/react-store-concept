{"ast":null,"code":"import _regeneratorRuntime from\"/Users/danielsmagly/Desktop/ReactStoreConcept/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/danielsmagly/Desktop/ReactStoreConcept/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import React from'react';import{Typography,Button,Divider}from'@material-ui/core';import{Elements,CardElement,ElementsConsumer}from'@stripe/react-stripe-js';import{loadStripe}from'@stripe/stripe-js';import Review from'./Review';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var stripePromise=loadStripe(process.env.REACT_APP_STRIPE_PUBLIC_KEY);var PaymentForm=function PaymentForm(_ref){var checkoutToken=_ref.checkoutToken,nextStep=_ref.nextStep,backStep=_ref.backStep,shippingData=_ref.shippingData,onCaptureCheckout=_ref.onCaptureCheckout,timeout=_ref.timeout;var handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(event,elements,stripe){var cardElement,_yield$stripe$createP,error,paymentMethod,orderData;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:event.preventDefault();if(!(!stripe||!elements)){_context.next=3;break;}return _context.abrupt(\"return\");case 3:cardElement=elements.getElement(CardElement);_context.next=6;return stripe.createPaymentMethod({type:'card',card:cardElement});case 6:_yield$stripe$createP=_context.sent;error=_yield$stripe$createP.error;paymentMethod=_yield$stripe$createP.paymentMethod;if(error){console.log('[error]',error);}else{orderData={line_items:checkoutToken.live.line_items,customer:{firstname:shippingData.firstName,lastname:shippingData.lastName,email:shippingData.email},shipping:{name:'International',street:shippingData.address1,town_city:shippingData.city,county_state:shippingData.shippingSubdivision,postal_zip_code:shippingData.zip,country:shippingData.shippingCountry},fulfillment:{shipping_method:shippingData.shippingOption},payment:{gateway:'stripe',stripe:{payment_method_id:paymentMethod.id}}};onCaptureCheckout(checkoutToken.id,orderData);nextStep();}case 10:case\"end\":return _context.stop();}}},_callee);}));return function handleSubmit(_x,_x2,_x3){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Review,{checkoutToken:checkoutToken}),/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,style:{margin:'20px 0'},children:\"Payment method\"}),/*#__PURE__*/_jsx(Elements,{stripe:stripePromise,children:/*#__PURE__*/_jsx(ElementsConsumer,{children:function children(_ref3){var elements=_ref3.elements,stripe=_ref3.stripe;return/*#__PURE__*/_jsxs(\"form\",{onSubmit:function onSubmit(e){return handleSubmit(e,elements,stripe);},children:[/*#__PURE__*/_jsx(CardElement,{}),/*#__PURE__*/_jsx(\"br\",{}),\" \",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between'},children:[/*#__PURE__*/_jsx(Button,{variant:\"outlined\",onClick:backStep,children:\"Back\"}),/*#__PURE__*/_jsxs(Button,{type:\"submit\",variant:\"contained\",disabled:!stripe,color:\"primary\",children:[\"Pay \",checkoutToken.live.subtotal.formatted_with_symbol]})]})]});}})})]});};export default PaymentForm;","map":{"version":3,"sources":["/Users/danielsmagly/Desktop/ReactStoreConcept/src/components/CheckoutForm/PaymentForm.jsx"],"names":["React","Typography","Button","Divider","Elements","CardElement","ElementsConsumer","loadStripe","Review","stripePromise","process","env","REACT_APP_STRIPE_PUBLIC_KEY","PaymentForm","checkoutToken","nextStep","backStep","shippingData","onCaptureCheckout","timeout","handleSubmit","event","elements","stripe","preventDefault","cardElement","getElement","createPaymentMethod","type","card","error","paymentMethod","console","log","orderData","line_items","live","customer","firstname","firstName","lastname","lastName","email","shipping","name","street","address1","town_city","city","county_state","shippingSubdivision","postal_zip_code","zip","country","shippingCountry","fulfillment","shipping_method","shippingOption","payment","gateway","payment_method_id","id","margin","e","display","justifyContent","subtotal","formatted_with_symbol"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Typography, Button, Divider } from '@material-ui/core';\nimport { Elements, CardElement, ElementsConsumer } from '@stripe/react-stripe-js';\nimport { loadStripe } from '@stripe/stripe-js';\n\nimport Review from './Review';\n\nconst stripePromise = loadStripe(process.env.REACT_APP_STRIPE_PUBLIC_KEY);\n\nconst PaymentForm = ({ checkoutToken, nextStep, backStep, shippingData, onCaptureCheckout, timeout }) => {\n  const handleSubmit = async (event, elements, stripe) => {\n    event.preventDefault();\n\n    if (!stripe || !elements) return;\n\n    const cardElement = elements.getElement(CardElement);\n\n    const { error, paymentMethod } = await stripe.createPaymentMethod({ type: 'card', card: cardElement });\n\n    if (error) {\n      console.log('[error]', error);\n    } else {\n      const orderData = {\n        line_items: checkoutToken.live.line_items,\n        customer: { firstname: shippingData.firstName, lastname: shippingData.lastName, email: shippingData.email },\n        shipping: { name: 'International', \n                    street: shippingData.address1, \n                    town_city: shippingData.city, \n                    county_state: shippingData.shippingSubdivision, \n                    postal_zip_code: shippingData.zip, \n                    country: shippingData.shippingCountry },\n\n        fulfillment: { shipping_method: shippingData.shippingOption },\n        payment: {\n          gateway: 'stripe',\n          stripe: {\n            payment_method_id: paymentMethod.id,\n          },\n        },\n      };\n\n      onCaptureCheckout(checkoutToken.id, orderData);\n\n      nextStep();\n    }\n  };\n\n  return (\n    <>\n      <Review checkoutToken={checkoutToken} />\n      <Divider />\n      <Typography variant=\"h6\" gutterBottom style={{ margin: '20px 0' }}>Payment method</Typography>\n      <Elements stripe={stripePromise}>\n        <ElementsConsumer>{({ elements, stripe }) => (\n          <form onSubmit={(e) => handleSubmit(e, elements, stripe)}>\n            <CardElement />\n            <br /> <br />\n            <div style={{ display: 'flex', justifyContent: 'space-between' }}>\n              <Button variant=\"outlined\" onClick={backStep}>Back</Button>\n              <Button type=\"submit\" variant=\"contained\" disabled={!stripe} color=\"primary\">\n                Pay {checkoutToken.live.subtotal.formatted_with_symbol}\n              </Button>\n            </div>\n          </form>\n        )}\n        </ElementsConsumer>\n      </Elements>\n    </>\n  );\n};\n\nexport default PaymentForm;"]},"metadata":{},"sourceType":"module"}